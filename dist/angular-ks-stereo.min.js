!function(){"use strict";angular.module("ks.stereo",[])}(),function(){"use strict";angular.module("ks.stereo").constant("MIN_SCALE",1e-7).constant("RADIAN",2*Math.PI)}(),function(){"use strict";function e(){return function(){var e=this;e.timer=null,e.startAnimation=function(n){!function t(){e.timer=requestAnimationFrame(t),n()}()},e.stopAnimation=function(){e.timer&&cancelAnimationFrame(e.timer),e.timer=null},e.isRunning=function(){return null!==e.timer}}}angular.module("ks.stereo").factory("ksAnimation",e)}(),function(){"use strict";function e(){var e=[{hex:"#f26046",r:242,g:96,b:70},{hex:"#ef8345",r:239,g:131,b:69},{hex:"#FF8200",r:255,g:130,b:0},{hex:"#f9b300",r:249,g:179,b:0},{hex:"#FCD200",r:252,g:210,b:0},{hex:"#91bc01",r:145,g:188,b:1},{hex:"#80BD01",r:128,g:189,b:1},{hex:"#40CE6D",r:64,g:206,b:109},{hex:"#00e2db",r:0,g:226,b:219},{hex:"#00BEE0",r:0,g:190,b:224},{hex:"#00AAE5",r:0,g:170,b:229}],s=this.defaults={src:null,autoplay:!1,enableAudio:!0,enableAudioContext:!0,colors:e};this.$get=function(e,u){var c={};return c.defaults=s,s.enableAudio?(c.audio=new Audio,c.audio.autoplay=!!s.autoplay,c.audioEnabled=!0,c.audio.controls=!0,c.audio.loop=!0,s.src&&(c.audio.src=s.src),c.percent=0,c.progress=0,c.play=function(){return c.audio.play()},c.playByPercent=function(e){c.audio.currentTime=c.audio.duration*(e/100),c.isPlaying()||c.play()},c.playByCurrentTime=function(e){c.audio.currentTime=e,c.isPlaying()||c.play()},c.isPlaying=function(){return!c.audio.paused},c.pause=function(){c.audio.pause()},c.toggle=function(){return c.audio.paused?c.play():c.pause()},c.audio.addEventListener("error",function(n){e.$broadcast(i,n)}),c.audio.addEventListener("loadstart",function(){e.$broadcast(r)}),c.audio.addEventListener("loadeddata",function(){e.$broadcast(a)}),c.audio.addEventListener("play",function(){c.change()},!1),c.audio.addEventListener("pause",function(){c.change(),e.$broadcast(n)},!1),c.change=function(){e.$broadcast(t)},c.onError=function(e,n){e.$on(i,n)},c.onChange=function(e,n){e.$on(t,n)},c.onPause=function(e,t){e.$on(n,t)},c.setProgress=function(){c.progress=c.audio.currentTime/c.audio.duration,c.progress||(c.progress=0)},c.onLoadStart=function(e,n){e.$on(r,n)},c.onLoadedData=function(e,n){e.$on(a,n)},c.onLoadedMetadata=function(e,n){e.$on(o,n)},c.loadedMetadata=function(){c.setProgress(),e.$broadcast(o)},c.audio.addEventListener("loadedmetadata",c.loadedMetadata),c.getColorByPercent=function(e){var n=parseInt(e/(100/s.colors.length),10);return s.colors[n]},s.enableAudioContext&&(c=u(c)),c):c}}angular.module("ks.stereo").provider("ksAudio",e);var n="ksAudio::onPause",t="ksAudio::onChange",o="ksAudio::onLoadedMetadata",r="ksAudio::onLoadStart",a="ksAudio::onLoadedData",i="ksAudio::onError"}(),function(){"use strict";function e(e,n,t){return function(o){function r(o){o=angular.extend({radius:u.radius,center:u.center,color:{r:255,g:255,b:255,a:1},lineWidth:1},o);var r=u.context,a=o.center,i=o.color,s=a.x,c=a.y;r.beginPath(),r.strokeStyle=n.getRgbaStr(i.r,i.g,i.b,i.a),r.lineWidth=o.lineWidth;for(var l=200,d=360/l,g=7,f=o.radius+10,m=1;l>=m;m++){var p=t.getPointByAngle(s,c,f,e*(d*m/360)),h=t.getPointByAngle(s,c,f+g,e*(d*m/360));r.moveTo(p.x,p.y),r.lineTo(h.x,h.y)}r.stroke()}function a(t){t=angular.extend({center:u.center,radius:u.radius,radian:e,color:{r:255,g:255,b:255,a:1},lineWidth:1},t);var o=t.center,r=t.color,a=t.a?t.a:r.a,i=u.context;i.beginPath(),i.lineWidth=t.lineWidth,i.strokeStyle=n.getRgbaStr(r.r,r.g,r.b,a),i.arc(o.x,o.y,t.radius,0,t.radian),i.stroke()}function i(t){t=angular.extend({context:null,radius:u.radius,radian:e,center:u.center,color:{r:255,g:255,b:255,a:1},colorStop:.5,colorAlpha:.5},t);var o=u.context,r=t.color,a=r.r,i=r.g,s=r.b,c=t.a?t.a:r.a,l=t.radius,d=t.center,g=d.x,f=d.y,m=o.createRadialGradient(g,f,0,g,f,l);m.addColorStop(0,n.getRgbaStr(a,i,s,c)),m.addColorStop(t.colorStop,n.getRgbaStr(a,i,s,t.colorAlpha)),m.addColorStop(1,n.getRgbaStr(a,i,s,0)),o.beginPath(),o.fillStyle=m,o.arc(g,f,l,0,t.radian),o.fill()}function s(t){t=angular.extend({radius:u.radius,radian:e,center:u.center,color:{r:255,g:255,b:255,a:1}},t);var o=u.context,r=t.color,a=t.a?t.a:r.a,i=t.center;o.beginPath(),o.fillStyle=n.getRgbaStr(r.r,r.g,r.b,a),o.arc(i.x,i.y,t.radius,0,t.radian),o.fill()}o=o||{};var u=this;return u.context=o.context,u.radius=o.radius||235,u.center=o.center||{x:0,y:0},{strokeCircle:a,blurCircle:i,fillCircle:s,strokeGraduation:r}}}angular.module("ks.stereo").factory("ksCanvasUtil",e),e.$inject=["RADIAN","ksHelper","ksMathUtil"]}(),function(){"use strict";function e(){var e=this,n=navigator.userAgent.toLowerCase();e.isSafari=-1===n.indexOf("chrome")&&n.indexOf("safari")>-1}angular.module("ks.stereo").service("ksDetector",e)}(),function(){"use strict";function e(e,n,t,o){var r="audioContext::onUpdate";return function(a){return a.AudioContext=e.AudioContext||e.webkitAudioContext,a.numBands=128,a.maxFrequency=177,a.context=new a.AudioContext,a.jsNode=a.context.createScriptProcessor(512,1,1),a.analyser=a.context.createAnalyser(),a.analyser.smoothingTimeConstant=.75,a.analyser.fftSize=2*a.numBands,a.analyser.minDecibels=-100,a.analyser.maxDecibels=-30,a.source=a.context.createMediaElementSource(a.audio),a.source.connect(a.analyser),a.analyser.connect(a.jsNode),a.jsNode.connect(a.context.destination),a.source.connect(a.context.destination),a.bands=new Uint8Array(a.analyser.frequencyBinCount),a.jsNode.onaudioprocess=function(){if(a.isPlaying()){if(a.analyser.getByteFrequencyData(a.bands),a.setProgress(),a.percent=parseInt(100*a.progress,10),t.isSafari)a.scale=.3;else{var e=o.getAverage(a.bands);a.scale=e/a.maxFrequency}a.update()}},a.update=function(e){n.$broadcast(r,e)},a.onUpdate=function(e,n){e.$on(r,function(e,t){n(t)})},a.audioContextEnabled=!0,a}}angular.module("ks.stereo").factory("ksEnableAudioContext",e),e.$inject=["$window","$rootScope","ksDetector","ksHelper"]}(),function(){"use strict";function e(e){var n=this,t=angular.element(e),o=e.Modernizr;n.$win=t,n.getMousePos=function(e,n){o&&o.touch&&(n=n.originalEvent.touches[0]);var t=e.getBoundingClientRect();return{x:n.clientX-t.left,y:n.clientY-t.top}},n.getRgbaStr=function(e,n,t,o){return"rgba("+[e,n,t,o].join(",")+")"},n.isWindowHeightChanged=function(e){return t.height()!==e},n.isWindowWidthChanged=function(e){return t.width()!==e},n.isWindowSizeChanged=function(e,t){return n.isWindowWidthChanged(e)||n.isWindowHeightChanged(t)},n.getAverage=function(e){for(var n=0,t=e.length,o=0;t>o;o++)n+=e[o];return n/t}}angular.module("ks.stereo").service("ksHelper",e),e.$inject=["$window"]}(),function(){"use strict";function e(){var e=this;e.getHypotenuse=function(e,n,t,o){return Math.sqrt(Math.pow(e-t,2)+Math.pow(n-o,2))},e.inCircle=function(n,t,o,r,a){var i=e.getHypotenuse(n,t,o,r);return a>i},e.getPointByAngle=function(e,n,t,o){return{x:e+Math.cos(o)*t,y:n+Math.sin(o)*t}}}angular.module("ks.stereo").service("ksMathUtil",e)}(),function(){"use strict";function e(e){var n=this,t="ksMusicControlButton::mousedown",o="ksMusicControlButton::mouseup";n.mousedown=function(){e.$broadcast(t)},n.mouseup=function(){e.$broadcast(o)},n.onMousedown=function(e,n){e.$on(t,n)},n.onMouseup=function(e,n){e.$on(o,n)}}angular.module("ks.stereo").service("ksMusicControlButton",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e){var n=this,t=null;n.webgl=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(n){return!1}}(),n.getRenderer=function(o){var r=e.THREE;return n.webgl?(t||(t=new r.WebGLRenderer(o)),t):new r.CanvasRenderer(o)}}angular.module("ks.stereo").service("ksThreeRenderer",e),e.$inject=["$window"]}(),function(){"use strict";function e(e,n,t,o){return{restrict:"A",template:'<div class="icosahedron"></div>',scope:{scale:"=",color:"="},link:function(r,a){function i(){return b>k?.65:1}function s(){k=C.width(),g.aspect=k/b,g.updateProjectionMatrix(),v.setSize(k,b)}function u(){$&&(cancelAnimationFrame($),$=null),$=requestAnimationFrame(s)}function c(){g=new x.PerspectiveCamera(75,k/b,1,1e4),g.position.z=e.isSafari?330:460,f=new x.Scene,m=new x.IcosahedronGeometry(280,0),p=new x.MeshBasicMaterial({color:15921906,transparent:!0,wireframe:!0}),h=new x.Mesh(m,p),f.add(h),v.setSize(k,b),a[0].appendChild(v.domElement)}function l(){var e=w.scale;switch(!0){case.3>e:return.2;case.6>e:return.25;case.9>e:return.3;default:return.5}}function d(){w.scale=r.scale,w.color=r.color.hex;var e=w.scale,n=w.rotationalSpeed;p.color.setStyle(w.color),p.opacity=l(),0===e&&(e=1e-5),h.rotation.x+=.01*n,h.rotation.y+=.02*n,e*=i(),h.scale.x=e,h.scale.y=e,h.scale.z=e,v.render(f,g)}var g,f,m,p,h,y=new o,v=t.getRenderer({alpha:!0}),x=n.THREE,w={color:r.color.hex,isAnimating:!1,stopAnalyzing:!1,scale:r.scale,rotationalSpeed:.3},A=angular.element(n),C=a.parent(),k=C.width(),b=C.height(),$=null;A.on("resize",u),c(),r.$watch("scale",function(e){0===e?setTimeout(function(){y.stopAnimation()},1e3/60):y.isRunning()||y.startAnimation(d)}),r.$on("$destroy",function(){y.stopAnimation(),f.remove(h),m.dispose(),p.dispose(),A.off("resize",u)})}}}angular.module("ks.stereo").directive("ksIcosahedron",e),e.$inject=["ksDetector","$window","ksThreeRenderer","ksAnimation"]}(),function(){"use strict";function e(e,n,t){return{restrict:"A",templateUrl:"/app/components/ks-music-control.html",link:function(o,r){var a={loading:!1,error:!1};o.getStatus=function(){return a.error?"error":a.loading?"loading":e.isPlaying()?"playing":"paused"},o.toggle=e.toggle,e.onChange(o,function(){o.$digest()}),e.onLoadStart(o,function(){a.loading=!0,a.error=!1}),e.onLoadedData(o,function(){a.loading=!1,o.$digest()}),e.onError(o,function(){a.error=!0,a.loading=!1,o.$digest()}),r.on("mousedown",t.mousedown),n.on("mouseup",t.mouseup)}}}angular.module("ks.stereo").directive("ksMusicControl",e),e.$inject=["ksAudio","$document","ksMusicControlButton"]}(),function(){"use strict";function e(e,n){return{restrict:"A",templateUrl:"/app/components/ks-stereo.html",controllerAs:"vm",controller:function(t){function o(){if(!(a.stereo.scale<=0)){var e=a.stereo.scale*u;!function n(){a.stereo.scale<e&&i.mousedown&&requestAnimationFrame(n),a.stereo.scale+=.01,t.$digest()}()}}function r(){var e=1;!function n(){a.stereo.scale>0&&requestAnimationFrame(n),a.stereo.scale-=.05*e,a.stereo.scale<=0&&(a.stereo.scale=0,s=!1),t.$digest()}()}var a=this,i={mousedown:!1},s=!1;a.stereo={scale:0,progress:0,color:e.getColorByPercent(e.percent)},e.onLoadedMetadata(t,function(){a.stereo.color=e.getColorByPercent(e.percent),a.stereo.progress=e.progress,t.$digest()}),e.onUpdate(t,function(){i.mousedown||s||(a.stereo.scale=e.scale,a.stereo.color=e.getColorByPercent(e.percent),a.stereo.progress=e.progress,t.$digest())});var u=1.2;n.onMousedown(t,function(){i.mousedown=!0,e.isPlaying()&&o()}),n.onMouseup(t,function(){i.mousedown=!1}),e.onPause(t,function(){r()})}}}angular.module("ks.stereo").directive("ksStereo",e),e.$inject=["ksAudio","ksMusicControlButton"]}(),function(){"use strict";function e(e,n,t,o,r,a,i){return{restrict:"A",template:"<canvas></canvas>",scope:{scale:"=",color:"=",progress:"="},link:function(s,u){function c(){var e=$,n=65;return e>b&&(e=b,n=30),e/2-n}function l(){k.clearRect(0,0,b,$);var n,o=B.scale,r=B.color,a=B.radius,i=B.layerCount;if(E.strokeCircle({radius:a,color:L,lineWidth:1.5}),E.strokeCircle({radius:a,radian:e*B.progress,color:r,a:1,lineWidth:1}),E.strokeGraduation({radius:a,color:L,lineWidth:1.5}),!(0>=o)){for(var s=0;i>s;s++)n=t.isPlaying()?10+s:0,E.fillCircle({radius:n+o*Math.pow(2,s)*(a/W),color:r,a:(1-s/i).toFixed(2)});E.blurCircle({radius:.38*a*o,color:r,a:1,colorStop:.3,colorAlpha:1})}}function d(e,n){var t=B.center,o=Math.sqrt(Math.pow(e-t.x,2)+Math.pow(n-t.y,2));return o<B.radius}function g(){var e=F.getCssClass();e!==C.className&&(C.className=e)}function f(e,n){var t=B.center,o=B.radius,r=i.getHypotenuse(t.x,t.y,n.x,n.y),a=r/o,s=(n.x-t.x)/a+t.x,u=(n.y-t.y)/a+t.y,c=i.getHypotenuse(t.x+o,t.y,s,u),l=Math.asin(c/2/o)/Math.PI*360;return n.y<t.y&&(l=180-l+180),l}function m(){var e=f(C,F),n=e/360*100;t.isPlaying()&&t.playByPercent(n)}function p(e){F.setPos(e),d(F.x,F.y)&&(F.mousedown=!0,g(),function n(){F.mousedown&&(requestAnimationFrame(n),m())}())}function h(e){F.setPos(e),F.mousedown||g()}function y(){F.mousedown=!1,g()}function v(){S=M.width(),P=M.height();var e=w.width();e!==b&&(b=w.width(),C.width=b,C.height=$,B.setBeltCenter(b,$),B.radius=c(),l())}function x(){return B.scale=s.scale,B.color=s.color,B.progress=s.progress,o.isWindowSizeChanged(S,P)?(v(),void 0):(l(),void 0)}var w=u.parent(),A=u.find("canvas"),C=A[0],k=C.getContext("2d"),b=w.width(),$=w.height(),M=o.$win,S=M.width(),P=M.height(),R=new a,B={color:s.color||{hex:"#f26046",r:242,g:96,b:70},center:{x:0,y:0},isAnimating:!1,radius:c(),scale:0,layerCount:26,progress:s.progress,stopAnalyzing:!1,setBeltCenter:function(e,n){var t=B.center,o=.5;t.x=parseInt(e/2,10)+o,t.y=parseInt(n/2,10)+o}},E=new r({context:k,center:B.center,radius:B.radius}),L={r:200,g:200,b:200,a:.1},W=14687500;C.width=b,C.height=$,B.setBeltCenter(b,$);var F={mousedown:!1,getCssClass:function(){var e=B.center;return F.inCircle(e.x,e.y,B.radius)?F.mousedown?"cursor-closehand":"cursor-openhand":"cursor-default"},x:null,y:null,setPos:function(e){var n=o.getMousePos(C,e);F.x=n.x,F.y=n.y},inCircle:function(e,n,t){return i.inCircle(F.x,F.y,e,n,t)}};A.on("mousedown",p),n.on("mousemove",h),n.on("mouseup",y),s.$watchCollection("[scale, progress]",function(e,n){var t=e[0],o=e[1],r=n[1];o>r&&!R.isRunning()&&requestAnimationFrame(x),0===t?setTimeout(function(){R.stopAnimation()},1e3/60):R.isRunning()||R.startAnimation(x)});var j=null;M.on("resize",function(){R.isRunning()||(j&&(cancelAnimationFrame(j),j=null),j=requestAnimationFrame(function(){v()}))}),x(),s.$on("$destroy",function(){R.stopAnimation(),A.off("mousedown",p),n.off("mousemove",h),n.off("mouseup",y)})}}}angular.module("ks.stereo").directive("ksVinyl",e),e.$inject=["RADIAN","$document","ksAudio","ksHelper","ksCanvasUtil","ksAnimation","ksMathUtil"]}();